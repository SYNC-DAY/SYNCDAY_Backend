<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.threeping.syncday.projmember.query.repository.ProjMemberMapper">

    <!-- Result map for ProjDTO -->
    <resultMap id="ProjResultMap" type="com.threeping.syncday.proj.query.aggregate.dto.ProjDTO">
        <id property="projId" column="proj_id"/>
        <result property="projName" column="proj_name"/>
        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="vcsInstallationIndex" column="vcs_installation_index"/>
    </resultMap>

    <!-- Result map for ProjMemberDTO with nested ProjDTO -->
    <resultMap id="ProjMemberResultMap" type="com.threeping.syncday.projmember.query.aggregate.dto.ProjMemberDTO">
        <id property="projMemberId" column="proj_member_id"/>
        <result property="bookmarkStatus" column="bookmark_status"/>
        <result property="participationStatus" column="participation_status"/>
        <result property="projId" column="proj_id"/>
        <result property="userId" column="user_id"/>
        <association property="proj" resultMap="ProjResultMap"/>
    </resultMap>

    <!-- Select project members with project info by user ID -->
    <select id="selectProjMembersByUserId" resultMap="ProjMemberResultMap">
        SELECT
            pm.proj_member_id,
            pm.bookmark_status,
            pm.participation_status,
            pm.proj_id,
            pm.user_id,
            p.proj_name,
            p.start_time,
            p.end_time,
            p.created_at,
            p.updated_at,
            p.vcs_installation_index
        FROM
            TBL_PROJ_MEMBER pm
                INNER JOIN TBL_PROJ p ON pm.proj_id = p.proj_id
        WHERE
            pm.user_id = #{userId}
    </select>

</mapper>